version: '3'
services: 
  mssql-server:
    image: mcr.microsoft.com/mssql/server:2019-latest
    container_name: mssql-server
    hostname: mssql-server
    ports:
      - "1433:1433"
      - "5022:5022"
    volumes: 
      - sqlsystem:/var/opt/mssql/
      - sqldata:/var/opt/sqlserver/data
      - sqllog:/var/opt/sqlserver/log
      - sqlbackup:/var/opt/sqlserver/backup
    environment:
      SA_PASSWORD: "Tr@nsF0rmer"
      ACCEPT_EULA : "Y"
      MSSQL_PID : "Developer"
      TZ : "Europe/Moscow"
      MSSQL_LCID : "1049" # �������
      MSSQL_COLLATION : "Cyrillic_General_CI_AS"
      MSSQL_MEMORY_LIMIT_MB : "2048" #������ ������������ ����� ������ (� ��), ������� ����� ������������ SQL Server. �� ��������� �� ���������� 80% �� ������ ������ ���������� ������.
      MSSQL_TCP_PORT : "1433"      
      MSSQL_BACKUP_DIR : "/var/opt/sqlserver/backup" #������� ������������ �������� ���������� ����������� �� ���������.
      MSSQL_DATA_DIR : "/var/opt/mssql/data" #��������� � �������, ��� ��������� ����� ���� ������ ����� ������ SQL Server (.mdf).
      MSSQL_LOG_DIR : "/var/opt/mssql/log" #��� ��������� ����� ����� �������� (LDF) ���� ������ SQL Server.
      # MSSQL_DUMP_DIR : "/var/opt/mssql/dumps" #��� SQL Server ����� ������������ ����� ������ � ������ ����� ��� ���������� ��������� �� ���������.
      MSSQL_ENABLE_HADR : "0" #��������� ������ �����������. �������� "1" �������� � ��������� "0" - ����������
      MSSQL_AGENT_ENABLED : "true" #�������� ����� SQL Server. �������� �true� �������, � �false� ���������. �� ��������� ����� ��������.
      #MSSQL_MASTER_DATA_FILE" #������ ������������ ����� ������ ���� ������ master.
      #MSSQL_ERROR_LOG_FILE" #������ ������������ ����� ������� ���� ������ master.
      #MSSQL_MASTER_LOG_FILE" #������ ������������ ������ ������� ������.
    restart: always
  my_books:
    build: 
      context: my_books/
      ## args:
      ##   HTTP_PROXY: "http://spb99-prx-a.gazprom-neft.local:8090"
      ##   HTTPS_PROXY: "http://spb99-prx-a.gazprom-neft.local:8090"
      ##   http_proxy: "http://spb99-prx-a.gazprom-neft.local:8090"
      ##   https_proxy: "http://spb99-prx-a.gazprom-neft.local:8090"
    image: vasire/my_book
    ports:
    - "8000:80"
    - "8001:443"
    environment:
      ASPNETCORE_URLS: "https://+;http://+"
      ASPNETCORE_HTTPS_PORT: "8001"
      ASPNETCORE_ENVIRONMENT: Development
    volumes:
      - ${APPDATA}\microsoft\UserSecrets\:/root/.microsoft/usersecrets
      - ${USERPROFILE}\.aspnet\https:/root/.aspnet/https/ 
volumes:
  sqlsystem:
  sqldata:
  sqllog:
  sqlbackup:
